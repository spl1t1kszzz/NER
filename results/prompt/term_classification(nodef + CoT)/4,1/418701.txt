Изучаем O  
синтаксические B-Method  
парсеры I-Method  
для O  
русского B-Lang  
языка I-Lang  
/ O  
Habr B-InfoResource  

9 O  
August O  
2018 O  
at O  
09:00 O  
Изучаем O  
синтаксические B-Method  
парсеры I-Method  
для O  
русского B-Lang  
языка I-Lang  
Сбер B-Organization  
corporate I-Organization  
blog I-Organization  
Programming B-Subject  
*Machine B-Method_ML  
learning I-Method_ML  
*Artificial B-Method_ML  
Intelligence I-Method_ML  
Привет O  
! O  
Меня O  
зовут O  
Денис B-Person  
Кирьянов I-Person  
, O  
я O  
работаю O  
в O  
Сбербанке B-Organization  
и O  
занимаюсь O  
проблемами O  
обработки B-Task  
естественного B-Task  
языка I-Task  
( O  
NLP B-Method_ML  
) O  
. O  
Однажды O  
нам O  
понадобилось O  
выбрать O  
синтаксический B-Method  
парсер I-Method  
для O  
работы O  
с O  
русским B-Lang  
языком I-Lang  
. O  
Для O  
этого O  
мы O  
углубились O  
в O  
дебри O  
морфологии B-Method  
и O  
токенизации B-Method  
, O  
протестировали O  
разные O  
варианты O  
и O  
оценили O  
их O  
применение O  
. O  
Делимся O  
опытом O  
в O  
этом O  
посте O  
. O  

Подготовка O  
к O  
отбору O  

Начнём O  
с O  
основ O  
: O  
как O  
все O  
работает O  
? O  
Мы O  
берем O  
текст O  
, O  
проводим O  
токенизацию B-Method  
и O  
получаем O  
некоторый O  
массив O  
псевдослов-токенов O  
. O  
Этапы O  
дальнейшего O  
анализа O  
укладываются O  
в O  
пирамиду O  
: O  

Начинается O  
все O  
с O  
морфологии B-Method  
— O  
с O  
анализа B-Method  
формы I-Method  
слова I-Method  
и O  
его O  
грамматических O  
категорий O  
( O  
род O  
, O  
падеж O  
и O  
т.п. O  
) O  
. O  
На O  
морфологии B-Method  
базируется O  
синтаксис B-Method  
— O  
взаимоотношения O  
за O  
рамками O  
одного O  
слова O  
, O  
между O  
словами O  
. O  
Синтаксические B-Method  
парсеры I-Method  
, O  
о O  
которых O  
пойдет O  
речь O  
, O  
анализируют O  
текст O  
и O  
выдают O  
структуру O  
зависимостей O  
слов O  
друг O  
от O  
друга O  
. O  

Грамматика B-Method  
зависимостей I-Method  
и O  
грамматика B-Method  
непосредственных I-Method  
составляющих I-Method  

Есть O  
два O  
основных O  
подхода O  
к O  
синтаксическому B-Method  
анализу I-Method  
, O  
которые O  
в O  
лингвистической B-Science  
теории I-Science  
существуют O  
примерно O  
на O  
равных O  
. O  

В O  
первой O  
строке O  
предложение O  
разобрано O  
в O  
рамках O  
грамматики B-Method  
зависимостей I-Method  
. O  
Этому O  
подходу O  
учат O  
в O  
школе O  
. O  
Каждое O  
слово O  
в O  
предложении O  
как-то O  
связано O  
с O  
другими O  
. O  
« O  
Мыла O  
» O  
— O  
сказуемое O  
, O  
от O  
которого O  
зависит O  
подлежащее O  
« O  
мама O  
» O  
( O  
здесь O  
грамматика B-Method  
зависимостей I-Method  
расходится O  
со O  
школьной O  
, O  
где O  
сказуемое O  
зависит O  
от O  
подлежащего O  
) O  
. O  
У O  
подлежащего O  
есть O  
зависимое O  
определение O  
« O  
моя O  
» O  
. O  
У O  
сказуемого O  
есть O  
зависимое O  
прямое O  
дополнение O  
« O  
раму O  
» O  
. O  
А O  
у O  
прямого O  
дополнения O  
« O  
раму O  
» O  
— O  
определение O  
« O  
грязную O  
» O  
. O  

Во O  
второй O  
строке O  
разбор O  
идет O  
в O  
соответствии O  
с O  
грамматикой B-Method  
непосредственно I-Method  
составляющих I-Method  
. O  

Согласно O  
ей O  
, O  
предложение O  
делится O  
на O  
группы O  
слов O  
( O  
phrases O  
) O  
. O  
Слова O  
внутри O  
одной O  
группы O  
связаны O  
теснее O  
. O  
Слова O  
« O  
моя O  
» O  
и O  
« O  
мама O  
» O  
связаны O  
более O  
тесно O  
, O  
« O  
раму O  
» O  
и O  
« O  
грязную O  
» O  
— O  
тоже O  
. O  
И O  
есть O  
еще O  
отдельное O  
« O  
мыла O  
» O  
. O  

Второй O  
подход O  
для O  
автоматического O  
парсинга B-Method  
русского B-Lang  
языка I-Lang  
применим O  
плохо O  
, O  
потому O  
что O  
в O  
нем O  
тесно O  
связанные O  
слова O  
( O  
члены O  
одной O  
группы O  
) O  
очень O  
часто O  
не O  
стоят O  
подряд O  
. O  
Нам O  
пришлось O  
бы O  
объединять O  
их O  
странными O  
скобками O  
— O  
через O  
одно O  
или O  
два O  
слова O  
. O  
Поэтому O  
в O  
автоматическом O  
парсинге B-Method  
русского B-Lang  
языка I-Lang  
принято O  
работать O  
исходя O  
из O  
грамматики B-Method  
зависимостей I-Method  
. O  
Это O  
удобно O  
еще O  
и O  
потому O  
, O  
что O  
с O  
таким O  
« O  
фреймворком O  
» O  
все O  
знакомы O  
по O  
школе O  
. O  

Дерево B-Object  
зависимостей I-Object  

Набор O  
зависимостей O  
мы O  
можем O  
перевести O  
в O  
древовидную O  
структуру O  
. O  
Вершина O  
— O  
слово O  
« O  
мыла O  
» O  
, O  
некоторые O  
слова O  
напрямую O  
зависят O  
от O  
него O  
, O  
некоторые O  
зависят O  
от O  
его O  
зависимых O  
. O  
Вот O  
определение O  
дерева B-Object  
зависимостей I-Object  
из O  
учебника O  
Мартина B-Person  
и O  
Журафского B-Person  
: O  

Dependency B-Subject  
tree I-Subject  
is I-Subject  
a I-Subject  
directed I-Subject  
graph I-Subject  
that I-Subject  
satisfies I-Subject  
the I-Subject  
following I-Subject  
constraints I-Subject  
: O  

There O  
is O  
a O  
single O  
designated O  
root O  
node O  
that O  
has O  
no O  
incoming O  
arcs O  
. O  

With O  
the O  
exception O  
of O  
the O  
root O  
node O  
, O  
each O  
vertex O  
has O  
exactly O  
one O  
incoming O  
arc O  
. O  

There O  
is O  
a O  
unique O  
path O  
from O  
the O  
root O  
node O  
to O  
each O  
vertex O  
in O  
V O  
. O  

Есть O  
верхнеуровневый O  
узел O  
— O  
сказуемое O  
. O  
Из O  
него O  
можно O  
дойти O  
до O  
любого O  
слова O  
. O  
Каждое O  
слово O  
зависит O  
от O  
другого O  
, O  
но O  
только O  
от O  
одного O  
. O  
Дерево B-Object  
зависимостей I-Object  
выглядит O  
примерно O  
так O  
: O  

В O  
этом O  
дереве O  
рёбра O  
подписаны O  
некоторым O  
особым O  
типом O  
синтаксического O  
отношения O  
. O  
В O  
грамматике B-Method  
зависимостей I-Method  
анализируют O  
не O  
только O  
факт O  
связи O  
между O  
словами O  
, O  
но O  
и O  
характер O  
этой O  
связи O  
. O  
Например O  
, O  
« O  
is O  
taken O  
» O  
— O  
это O  
почти O  
одна O  
глагольная O  
форма O  
, O  
« O  
inventory O  
» O  
— O  
это O  
подлежащее O  
для O  
« O  
is O  
taken O  
» O  
. O  
Соответственно O  
, O  
у O  
нас O  
от O  
« O  
is O  
» O  
есть O  
ребро O  
и O  
в O  
одну O  
, O  
и O  
в O  
другую O  
сторону O  
. O  
Это O  
не O  
одинаковые O  
связи O  
, O  
они O  
носят O  
разный O  
характер O  
, O  
так O  
что O  
их O  
надо O  
различать O  
. O  

Здесь O  
и O  
далее O  
мы O  
рассматриваем O  
простые O  
случаи O  
, O  
где O  
члены O  
предложения O  
присутствуют O  
, O  
а O  
не O  
подразумеваются O  
. O  
Существуют O  
структуры O  
и O  
отметки O  
, O  
позволяющие O  
бороться O  
с O  
пропусками O  
. O  
В O  
дереве O  
появляется O  
нечто O  
, O  
у O  
чего O  
нет O  
поверхностного O  
выражения O  
— O  
слова O  
. O  
Но O  
это O  
уже O  
предмет O  
другого O  
исследования O  
, O  
а O  
нам O  
все-таки O  
надо O  
сосредоточиться O  
на O  
своем O  
. O  

Проект B-InfoResource  
Universal I-InfoResource  
Dependencies I-InfoResource  

Чтобы O  
облегчить O  
себе O  
выбор O  
парсера B-Method  
, O  
мы O  
обратили O  
свой O  
взгляд O  
на O  
проект B-InfoResource  
Universal I-InfoResource  
Dependencies I-InfoResource  
и O  
недавно O  
прошедшее O  
в O  
его O  
рамках O  
соревнование B-Activity  
CoNLL B-Activity  
Shared I-Activity  
Task I-Activity  
. O  

Universal B-InfoResource  
Dependencies I-InfoResource  
— O  
это O  
проект O  
по O  
унификации O  
разметки O  
синтаксических O  
корпусов O  
( O  
трибанков O  
) O  
в O  
рамках O  
грамматики B-Method  
зависимостей I-Method  
. O  
В O  
русском B-Lang  
языке I-Lang  
количество O  
типов O  
синтаксических O  
связей O  
ограничено O  
— O  
подлежащее O  
, O  
сказуемое O  
и O  
т.д O  
. O  
В O  
английском B-Lang  
то O  
же O  
самое O  
, O  
но O  
набор O  
уже O  
другой O  
. O  
Например O  
, O  
там O  
появляется O  
артикль O  
, O  
который O  
тоже O  
надо O  
как-то O  
маркировать O  
. O  
Если O  
бы O  
мы O  
хотели O  
написать O  
волшебный O  
парсер B-Method  
, O  
который O  
мог O  
бы O  
обрабатывать O  
все O  
языки O  
, O  
то O  
довольно O  
быстро O  
уперлись O  
бы O  
в O  
проблемы O  
сопоставления O  
разных O  
грамматик O  
. O  
Героическим O  
создателям O  
Universal B-InfoResource  
Dependencies I-InfoResource  
удалось O  
договориться O  
между O  
собой O  
и O  
разметить O  
все O  
корпусы O  
, O  
которые O  
имелись O  
в O  
их O  
распоряжении O  
, O  
в O  
едином O  
формате O  
. O  
Не O  
очень O  
важно O  
, O  
как O  
именно O  
они O  
договорились O  
, O  
главное O  
, O  
что O  
на O  
выходе O  
мы O  
получили O  
некий O  
единообразный O  
формат O  
представления O  
всей O  
этой O  
истории O  
— O  
более O  
100 O  
трибанков O  
для O  
60 O  
языков O  
. O  

CoNLL B-Activity  
Shared I-Activity  
Task I-Activity  
— O  
это O  
соревнование O  
между O  
разработчиками O  
алгоритмов O  
синтаксического B-Method  
парсинга I-Method  
, O  
проводимое O  
в O  
рамках O  
проекта B-InfoResource  
Universal I-InfoResource  
Dependencies I-InfoResource  
. O  
Организаторы O  
берут O  
некоторое O  
количество O  
трибанков O  
и O  
разбивают O  
каждый O  
из O  
них O  
на O  
три O  
части O  
— O  
обучающую O  
, O  
валидационную O  
и O  
тестовую O  
. O  
Первая O  
часть O  
предоставляется O  
участникам O  
соревнования O  
, O  
чтобы O  
они O  
обучили O  
на O  
ней O  
свои O  
модели B-Model  
. O  
Вторая O  
часть O  
тоже O  
используется O  
участниками O  
— O  
чтобы O  
после O  
обучения O  
оценить O  
работу O  
алгоритма O  
. O  
Обучение O  
и O  
оценку O  
участники O  
могут O  
итеративно O  
повторять O  
. O  
Потом O  
они O  
отдают O  
свой O  
лучший O  
алгоритм O  
организаторам O  
, O  
которые O  
прогоняют O  
его O  
на O  
тестовой O  
части O  
, O  
закрытой O  
для O  
участников O  
. O  
Итоги O  
работы O  
моделей B-Model  
на O  
тестовых O  
частях O  
трибанков O  
— O  
это O  
и O  
есть O  
итоги O  
соревнования O  
. O  

Метрики B-Metric  
качества I-Metric  

У O  
нас O  
есть O  
связи O  
между O  
словами O  
и O  
их O  
типы O  
. O  
Мы O  
можем O  
оценивать O  
, O  
правильно O  
ли O  
нашли O  
вершину O  
слова O  
— O  
метрика B-Metric  
UAS I-Metric  
( O  
Unlabeled I-Metric  
attachment I-Metric  
score I-Metric  
) O  
. O  
Или O  
оценивать O  
, O  
правильно O  
ли O  
найдена O  
как O  
вершина O  
, O  
так O  
и O  
тип O  
зависимости O  
— O  
метрика B-Metric  
LAS I-Metric  
( O  
Labeled I-Metric  
attachment I-Metric  
score I-Metric  
) O  
. O  

Казалось O  
бы O  
, O  
здесь O  
напрашивается O  
оценка B-Metric  
точности I-Metric  
( O  
accuracy B-Metric  
) O  
— O  
считаем O  
, O  
сколько O  
раз O  
мы O  
попали O  
из O  
общего O  
количества O  
случаев O  
. O  
Если O  
у O  
нас O  
есть O  
5 O  
слов O  
и O  
для O  
4 O  
мы O  
правильно O  
определили O  
вершину O  
, O  
то O  
получаем O  
80 O  
% O  
. O  

Но O  
на O  
самом O  
деле O  
оценить O  
парсер B-Method  
в O  
чистом O  
виде O  
проблематично O  
. O  
Разработчики O  
, O  
решающие O  
задачи O  
автоматического O  
парсинга B-Method  
, O  
часто O  
берут O  
на O  
вход O  
сырой O  
текст O  
, O  
который O  
в O  
соответствии O  
с O  
пирамидой O  
анализа O  
проходит O  
этапы O  
токенизации B-Method  
и O  
морфологического B-Method  
анализа I-Method  
. O  
На O  
качество O  
работы O  
парсера B-Method  
могут O  
повлиять O  
ошибки O  
с O  
этих O  
более O  
ранних O  
этапов O  
. O  
В O  
частности O  
, O  
это O  
относится O  
к O  
процедуре O  
токенизации B-Method  
— O  
выделения O  
слов O  
. O  
Если O  
мы O  
выделили O  
неправильные O  
слова-юниты O  
, O  
то O  
уже O  
не O  
сможем O  
корректно O  
оценить O  
синтаксические B-Method  
связи I-Method  
между O  
ними O  
— O  
ведь O  
в O  
нашем O  
исходном O  
размеченном O  
корпусе O  
юниты O  
были O  
другие O  
. O  

Поэтому O  
формулой O  
оценки B-Metric  
в O  
данном O  
случае O  
является O  
ф-мера B-Metric  
, O  
где O  
точность B-Metric  
( O  
precision B-Metric  
) O  
— O  
доля O  
точных O  
попаданий O  
относительно O  
общего O  
числа O  
предсказаний O  
, O  
а O  
полнота B-Metric  
— O  
доля O  
точных O  
попаданий O  
относительно O  
числа O  
связей O  
в O  
размеченных O  
данных O  
. O  

Когда O  
мы O  
в O  
дальнейшем O  
будем O  
приводить O  
оценки B-Metric  
, O  
нужно O  
помнить O  
, O  
что O  
используемые O  
метрики B-Metric  
затрагивают O  
не O  
только O  
синтаксис B-Method  
, O  
но O  
еще O  
и O  
качество O  
разбиения O  
на O  
токены O  
. O  

Русский B-Lang  
язык I-Lang  
в O  
Universal B-InfoResource  
Dependencies I-InfoResource  

Для O  
того O  
, O  
чтобы O  
парсер B-Method  
смог O  
синтаксически O  
размечать O  
предложения O  
, O  
которых O  
он O  
еще O  
не O  
видел O  
, O  
ему O  
для O  
обучения O  
нужно O  
скормить O  
размеченный O  
корпус O  
. O  
Для O  
русского B-Lang  
языка I-Lang  
есть O  
несколько O  
таких O  
корпусов O  
: O  

Во O  
втором O  
столбце O  
указано O  
количество O  
токенов O  
— O  
слов O  
. O  
Чем O  
больше O  
токенов O  
, O  
тем O  
больше O  
обучающий O  
корпус O  
и O  
лучше O  
итоговый O  
алгоритм O  
( O  
если O  
это O  
хорошие O  
данные O  
) O  
. O  
Очевидно O  
, O  
что O  
все O  
эксперименты O  
проводятся O  
на O  
SynTagRus B-Dataset  
( O  
разработка O  
ИППИ B-Organization  
РАН I-Organization  
) O  
, O  
в котором более миллиона токенов O  
. O  
На O  
нем O  
будут O  
обучаться O  
все O  
алгоритмы O  
, O  
о O  
которых O  
пойдет O  
речь O  
дальше O  
. O  

Парсеры B-Method  
для O  
русского B-Lang  
языка I-Lang  
в O  
CoNLL B-Activity  
Shared I-Activity  
Task I-Activity  

По O  
итогам O  
соревнования O  
прошлого O  
года O  
модели B-Model  
, O  
которые O  
обучались O  
на O  
одном O  
и O  
том O  
же O  
SynTagRus B-Dataset  
, O  
достигли O  
следующих O  
показателей O  
LAS B-Metric  
: O  

Результаты O  
парсеров B-Method  
для O  
русского B-Lang  
впечатляют O  
— O  
они O  
лучше O  
чем O  
у O  
парсеров B-Method  
для O  
английского B-Lang  
, O  
французского B-Lang  
и O  
других O  
более O  
редких O  
языков O  
. O  
Нам O  
с O  
вами O  
очень O  
повезло O  
сразу O  
по O  
двум O  
причинам O  
. O  
Во-первых O  
, O  
алгоритмы O  
хорошо O  
справляются O  
с O  
русским B-Lang  
языком I-Lang  
. O  
Во-вторых O  
, O  
у O  
нас O  
есть O  
SynTagRus B-Dataset  
— O  
большой O  
и O  
размеченный O  
корпус O  
. O  

Кстати O  
, O  
уже O  
прошло O  
соревнование O  
2018 O  
года O  
, O  
но O  
своё O  
исследование O  
мы O  
проводили O  
весной O  
этого O  
года O  
, O  
так O  
что O  
мы O  
опираемся O  
на O  
итоги O  
дорожки O  
прошлого O  
года O  
. O  
Забегая O  
вперёд O  
, O  
заметим O  
, O  
что O  
новая O  
версия O  
UDPipe B-Application  
( O  
Future O  
) O  
оказалась O  
ещё O  
выше O  
в O  
этом O  
году O  
. O  

В O  
список O  
не O  
вошёл O  
Syntaxnet B-Application  
— O  
парсер B-Method  
Google B-Organization  
. O  
Что O  
с O  
ним O  
не O  
так O  
? O  
Ответ O  
прост O  
: O  
Syntaxnet B-Application  
начинался O  
лишь O  
с O  
этапа O  
морфологического B-Method  
анализа I-Method  
. O  
Он O  
брал O  
готовую O  
идеальную O  
токенизацию B-Method  
, O  
а O  
уже O  
поверх O  
строил O  
обработку O  
. O  
Поэтому O  
оценивать O  
его O  
наравне O  
с O  
остальными O  
нечестно O  
— O  
остальные O  
делали O  
разбиение O  
на O  
токены O  
своими O  
алгоритмами O  
, O  
и O  
это O  
могло O  
ухудшить O  
результаты O  
на O  
последующем O  
этапе O  
синтаксиса B-Method  
. O  
У O  
Syntaxnet B-Application  
образца O  
2017 O  
года O  
результат O  
лучше O  
, O  
чем O  
у O  
всего O  
списка O  
выше O  
, O  
но O  
проводить O  
сравнение O  
напрямую O  
нечестно O  
. O  

В O  
таблицу O  
попали O  
две O  
версии O  
UDPipe B-Application  
, O  
на O  
12 O  
и O  
15 O  
места O  
. O  
Разработкой O  
этого O  
парсера B-Method  
занимаются O  
те O  
же O  
люди O  
, O  
которые O  
принимали O  
активное O  
участие O  
в O  
самом O  
проекте B-InfoResource  
Universal I-InfoResource  
Dependencies I-InfoResource  
. O  

Периодически O  
появляются O  
обновления O  
UDPipe B-Application  
( O  
несколько O  
реже O  
, O  
кстати O  
, O  
обновляется O  
и O  
разметка O  
корпусов O  
) O  
. O  
Так O  
, O  
уже O  
после O  
соревнования O  
прошлого O  
года O  
UDPipe B-Application  
обновлялся O  
( O  
это O  
были O  
коммиты O  
в O  
ещё O  
не O  
вышедшую O  
версию O  
2.0 O  
; O  
в O  
дальнейшем O  
для O  
простоты O  
мы O  
будем O  
грубо O  
называть O  
взятый O  
нами O  
коммит O  
UDPipe B-Application  
2.0 I-Application  
, O  
хотя O  
строго O  
говоря O  
это O  
не O  
так O  
) O  
; O  
этих O  
обновлений O  
в O  
таблице O  
соревнования O  
, O  
разумеется O  
, O  
нет O  
. O  
Результат O  
« O  
нашего O  
» O  
коммита O  
находится O  
примерно O  
в O  
районе O  
седьмого O  
места O  
. O  

Итак O  
, O  
нам O  
нужно O  
выбрать O  
парсер B-Method  
для O  
русского B-Lang  
языка I-Lang  
. O  
В O  
качестве O  
начальных O  
данных O  
у O  
нас O  
есть O  
табличка O  
выше O  
с O  
лидирующим O  
Syntaxnet B-Application  
и O  
с O  
UDPipe B-Application  
2.0 I-Application  
где-то O  
на O  
7 O  
месте O  
. O  

Выбираем O  
модель B-Model  

Делаем O  
просто O  
: O  
начинаем O  
с O  
парсера B-Method  
с O  
самыми O  
высокими O  
показателями O  
. O  
Если O  
с O  
ним O  
что-то O  
не O  
так O  
, O  
идём O  
ниже O  
. O  
Что-то O  
не O  
так O  
может O  
быть O  
по O  
следующим O  
критериям O  
— O  
может O  
, O  
они O  
не O  
идеальны O  
, O  
но O  
нам O  
подошли O  
: O  

Скорость O  
работы O  
. O  
Наш O  
парсер B-Method  
должен O  
работать O  
достаточно O  
быстро O  
. O  
Синтаксис B-Method  
, O  
разумеется O  
, O  
далеко O  
не O  
единственный O  
модуль O  
« O  
под O  
капотом O  
» O  
real-time O  
системы O  
, O  
поэтому O  
тратить O  
на O  
него O  
больше O  
десятка O  
миллисекунд O  
не O  
стоит O  
. O  

Качество O  
работы O  
. O  
Как O  
минимум O  
, O  
самого O  
парсера B-Method  
именно O  
на O  
данных O  
русского B-Lang  
языка I-Lang  
. O  
Требование O  
очевидное O  
. O  
Для O  
русского B-Lang  
языка I-Lang  
у O  
нас O  
есть O  
достаточно O  
хорошие O  
морфологические B-Method  
анализаторы I-Method  
, O  
которые O  
могут O  
встроиться O  
в O  
нашу O  
пирамиду O  
. O  
Если O  
мы O  
сможем O  
убедиться O  
, O  
что O  
сам O  
парсер B-Method  
без O  
морфологии B-Method  
круто O  
работает O  
, O  
то O  
это O  
нас O  
устроит O  
— O  
морфологию B-Method  
подсунем O  
потом O  
. O  

Наличие O  
кода O  
обучения O  
и O  
желательно O  
модели B-Model  
в O  
открытом O  
доступе O  
. O  
При O  
наличии O  
кода O  
обучения O  
мы O  
будем O  
способны O  
повторить O  
результаты O  
автора O  
модели B-Model  
. O  
Для O  
этого O  
они O  
должны O  
быть O  
открыты O  
. O  
И O  
, O  
кроме O  
того O  
, O  
нужно O  
внимательно O  
следить O  
за O  
условиями O  
распространения O  
корпусов O  
и O  
модели B-Model  
— O  
придётся O  
ли O  
нам O  
, O  
если O  
мы O  
будем O  
их O  
использовать O  
в O  
рамках O  
своих O  
алгоритмов O  
, O  
покупать O  
лицензию O  
на O  
их O  
использование O  
? O  

Запуск O  
без O  
сверхусилий O  
. O  
Этот O  
пункт O  
очень O  
субъективный O  
, O  
но O  
важный O  
. O  
Что O  
это O  
значит O  
? O  
Это O  
значит O  
, O  
что O  
если O  
мы O  
три O  
дня O  
сидим O  
и O  
что-то O  
запускаем O  
, O  
а O  
оно O  
не O  
запускается O  
, O  
то O  
выбрать O  
этот O  
парсер B-Method  
мы O  
не O  
сможем O  
, O  
даже O  
если O  
там O  
будет O  
идеальное O  
качество O  
. O  

Все O  
, O  
что O  
в O  
чарте O  
парсеров B-Method  
было O  
выше O  
UDPipe B-Application  
2.0 I-Application  
, O  
нам O  
не O  
подошло O  
. O  
У O  
нас O  
проект O  
на O  
Python O  
, O  
а O  
некоторые O  
парсеры B-Method  
из O  
списка O  
написаны O  
не O  
на O  
Python O  
. O  
Чтобы O  
имплементировать O  
их O  
в O  
питонский O  
проект O  
, O  
пришлось O  
бы O  
применить O  
те O  
самые O  
сверхусилия O  
. O  
В O  
других O  
случаях O  
мы O  
сталкивались O  
с O  
закрытым O  
исходным O  
кодом O  
, O  
академическими O  
, O  
индустриальными O  
разработками O  
— O  
в O  
общем O  
, O  
не O  
докопаешься O  
. O  

Звёздный O  
Syntaxnet B-Application  
заслуживает O  
отдельного O  
рассказа O  
про O  
качество O  
работы O  
. O  
Здесь O  
же O  
он O  
нас O  
не O  
устроил O  
по O  
скорости O  
работы O  
. O  
Время O  
его O  
ответа O  
на O  
какие-то O  
простые O  
, O  
распространённые O  
в O  
чатах O  
фразы O  
составляет O  
от O  
100 O  
миллисекунд O  
. O  
Если O  
мы O  
столько O  
будем O  
тратить O  
на O  
синтаксис B-Method  
, O  
нам O  
не O  
хватит O  
времени O  
ни O  
на O  
что O  
другое O  
. O  
В O  
то O  
же O  
самое O  
время O  
UDPipe B-Application  
2 O  
.0 I-Application  
делает O  
разбор O  
предложения O  
за O  
~3ms O  
. O  
В O  
итоге O  
выбор O  
пал O  
на O  
UDPipe B-Application  
2.0 I-Application  
. O  

UDPipe B-Application  
2.0 I-Application  

UDPipe B-Application  
— O  
пайплайн O  
, O  
который O  
обучается O  
токенизации B-Method  
, O  
лемматизации B-Method  
, O  
морфологическому B-Method  
тэггингу I-Method  
и O  
парсингу B-Method  
, O  
основанному O  
на O  
грамматике B-Method  
зависимостей I-Method  
. O  
Мы O  
можем O  
обучить O  
его O  
всему O  
этому O  
или O  
чему-то O  
отдельно O  
. O  
Например O  
, O  
сделать O  
с O  
ним O  
ещё O  
один O  
морфологический B-Method  
анализатор I-Method  
для O  
русского B-Lang  
языка I-Lang  
. O  
Или O  
обучить O  
и O  
использовать O  
UDPipe B-Application  
в O  
качестве O  
токенизатора B-Method  
. O  

UDPipe B-Application  
2.0 I-Application  
подробно O  
задокументирован O  
. O  
Есть O  
описание O  
архитектуры O  
, O  
репозиторий O  
с O  
кодом O  
обучения O  
, O  
мануал O  
. O  
Самое O  
интересное O  
— O  
это O  
готовые O  
модели B-Model  
, O  
в O  
том O  
числе O  
и O  
для O  
русского B-Lang  
языка I-Lang  
. O  
Качай O  
и O  
запускай O  
. O  
Также O  
на O  
этом O  
ресурсе O  
зарелизены O  
подобранные O  
для O  
каждого O  
языкового O  
корпуса O  
параметры O  
обучения O  
. O  
Для O  
каждой O  
такой O  
модели B-Model  
нужно O  
порядка O  
60 O  
параметров O  
обучения O  
, O  
и O  
с O  
их O  
помощью O  
можно O  
самостоятельно O  
добиться O  
таких O  
же O  
показателей O  
качества O  
, O  
как O  
в O  
таблице O  
. O  
Они O  
могут O  
быть O  
не O  
оптимальны O  
, O  
но O  
по O  
крайней O  
мере O  
мы O  
можем O  
быть O  
уверены O  
, O  
что O  
пайплайн O  
будет O  
работать O  
достаточно O  
корректно O  
. O  
Кроме O  
того O  
, O  
наличие O  
такого O  
референса O  
позволяет O  
нам O  
спокойно O  
поэкспериментировать O  
с O  
моделью B-Model  
самостоятельно O  
. O  

Как O  
работает O  
UDPipe B-Application  
2.0 I-Application  

Сначала O  
текст O  
разделяется O  
на O  
предложения O  
, O  
а O  
предложения O  
— O  
на O  
слова O  
. O  
UDPipe B-Application  
делает O  
всё O  
это O  
сразу O  
с O  
помощью O  
совместного O  
модуля O  
— O  
нейронной B-Method_ML  
сети I-Method_ML  
( O  
однослойной O  
двухсторонней O  
GRU B-Model  
) O  
, O  
которая O  
для O  
каждого O  
символа O  
предсказывает O  
, O  
последний O  
ли O  
он O  
в O  
предложении O  
или O  
в O  
слове O  
. O  

Затем O  
начинает O  
работу O  
теггер O  
— O  
штука O  
, O  
которая O  
предсказывает O  
морфологические B-Method  
свойства I-Method  
токена O  
: O  
в O  
каком O  
падеже O  
слово O  
стоит O  
, O  
в O  
каком O  
числе O  
. O  
По O  
последним O  
четырём O  
символам O  
каждого O  
слова O  
теггер O  
генерирует O  
гипотезы O  
относительно O  
части O  
речи O  
и O  
морфологических B-Method  
тегов I-Method  
этого O  
слова O  
, O  
а O  
затем O  
при O  
помощи O  
перцептрона B-Model  
отбирает O  
лучший O  
вариант O  
. O  

В O  
UDPipe B-Application  
есть O  
ещё O  
лемматизатор B-Method  
, O  
который O  
подбирает O  
для O  
слов O  
начальную O  
форму O  
. O  
Он O  
обучается O  
примерно O  
по O  
тому O  
же O  
принципу O  
, O  
по O  
которому O  
не-носитель O  
языка O  
мог O  
бы O  
попытаться O  
определить O  
лемму O  
незнакомого O  
ему O  
слова O  
. O  
Отрезаем O  
приставку O  
и O  
конец O  
слова O  
, O  
добавляем O  
какой-нибудь O  
« O  
ть O  
» O  
, O  
который O  
присутствует O  
в O  
начальной O  
форме O  
глагола O  
и O  
т.п O  
. O  
Так O  
генерируются O  
кандидаты O  
, O  
из O  
которых O  
наилучшего O  
выбирает O  
перцептрон B-Model  
. O  

Схема O  
морфологического B-Method  
теггирования I-Method  
( O  
определение O  
числа O  
, O  
падежа O  
и O  
всего O  
остального O  
) O  
и O  
предсказания O  
лемм O  
очень O  
похожи O  
. O  
Их O  
можно O  
предсказывать O  
вместе O  
, O  
но O  
лучше O  
раздельно O  
— O  
слишком O  
уж O  
богата O  
морфология B-Method  
русского B-Lang  
языка I-Lang  
. O  
Можно O  
также O  
подключить O  
свой O  
список O  
лемм O  
. O  

Перейдём O  
к O  
самому O  
интересному O  
— O  
к O  
парсеру B-Method  
. O  
Есть O  
несколько O  
архитектур O  
dependency-парсеров B-Method  
. O  
UDPipe B-Application  
— O  
это O  
transition-based B-Method  
архитектура I-Method  
: O  
она O  
работает O  
быстро O  
, O  
за O  
линейное O  
время O  
проходя O  
по O  
всем O  
токенам O  
один O  
раз O  
. O  

Синтаксический B-Method  
парсинг I-Method  
в O  
такой O  
архитектуре O  
начинается O  
со O  
стека O  
( O  
где O  
в O  
начале O  
только O  
root O  
) O  
и O  
пустой O  
конфигурации O  
. O  
Есть O  
три O  
дефолтных O  
способа O  
её O  
изменить O  
: O  

LeftArc O  
— O  
применим O  
, O  
если O  
второй O  
элемент O  
стека O  
не O  
root O  
. O  
Сохраняет O  
зависимость O  
между O  
токеном O  
на O  
верхушке O  
стека O  
и O  
вторым O  
токеном O  
, O  
а O  
также O  
выкидывает O  
второй O  
из O  
стека O  
. O  

RightArc O  
— O  
то O  
же O  
самое O  
, O  
но O  
зависимость O  
строится O  
в O  
другую O  
сторону O  
, O  
и O  
отбрасывается O  
верхушка O  
. O  

Shift O  
— O  
переносит O  
очередное O  
слово O  
из O  
буфера O  
в O  
стек O  
. O  

Ниже O  
приведен O  
пример O  
работы O  
парсера B-Method  
( O  
источник O  
) O  
. O  
У O  
нас O  
есть O  
фраза O  
« O  
book O  
me O  
the O  
morning O  
flight O  
» O  
, O  
и O  
мы O  
восстанавливаем O  
связи O  
в O  
ней O  
: O  

Вот O  
что O  
получается O  
в O  
итоге O  
: O  

У O  
классических O  
transition-based B-Method  
parser I-Method  
возможны O  
три O  
операции O  
, O  
перечисленные O  
выше O  
: O  
стрелка O  
в O  
одну O  
сторону O  
, O  
стрелка O  
в O  
другую O  
сторону O  
и O  
шифт O  
. O  
Есть O  
ещё O  
операция O  
Swap O  
, O  
в O  
базовых O  
архитектурах O  
transition-based B-Method  
парсеров I-Method  
она O  
не O  
используется O  
, O  
но O  
в O  
UDPipe B-Application  
включена O  
. O  
Swap O  
возвращает O  
второй O  
элемент O  
стека O  
в O  
буфер O  
, O  
чтобы O  
взять O  
потом O  
из O  
буфера O  
следующий O  
( O  
в O  
случае O  
если O  
они O  
разнесены O  
) O  
. O  
Это O  
помогает O  
пропустить O  
некоторое O  
количество O  
слов O  
и O  
восстановить O  
правильную O  
связь O  
. O  

По O  
ссылке O  
есть O  
хорошая O  
статья O  
человека O  
, O  
который O  
придумал O  
операцию O  
swap O  
. O  
Выделим O  
из O  
неё O  
один O  
момент O  
: O  
несмотря O  
на O  
то O  
, O  
что O  
мы O  
не O  
один O  
раз O  
проходим O  
по O  
исходному O  
буферу O  
токенов O  
( O  
т.е O  
. O  
наше O  
время O  
уже O  
не O  
линейное O  
) O  
, O  
эти O  
операции O  
можно O  
оптимизировать O  
так O  
, O  
чтобы O  
вернуть O  
время O  
очень O  
близко O  
к O  
линейному O  
. O  
То O  
есть O  
перед O  
нами O  
не O  
просто O  
осмысленная O  
с O  
точки O  
зрения O  
языка O  
операция O  
, O  
но O  
ещё O  
и O  
инструмент O  
, O  
не O  
сильно O  
замедляющий O  
работу O  
парсера B-Method  
. O  

На O  
примере O  
выше O  
мы O  
показали O  
операции O  
, O  
в O  
результате O  
которых O  
мы O  
получаем O  
некоторую O  
конфигурацию O  
— O  
буфер O  
токенов O  
и O  
связи O  
между O  
ними O  
. O  
Мы O  
отдаём O  
эту O  
конфигурацию O  
на O  
текущем O  
шаге O  
transition-based B-Method  
парсеру I-Method  
, O  
и O  
с O  
помощью O  
неё O  
он O  
должен O  
предсказать O  
конфигурацию O  
на O  
следующем O  
шаге O  
. O  
Сопоставляя O  
входящие O  
вектора O  
и O  
конфигурации O  
на O  
каждом O  
шаге O  
, O  
модель B-Model  
обучается O  
. O  

Итак O  
, O  
мы O  
отобрали O  
парсер B-Method  
, O  
который O  
подходит O  
под O  
все O  
наши O  
критерии O  
, O  
и O  
даже O  
поняли O  
, O  
как O  
он O  
работает O  
. O  
Переходим O  
к O  
экспериментам O  
. O  

Проблемы O  
UDPipe B-Application  

Зададим O  
небольшое O  
предложение O  
: O  
« O  
Переведи O  
маме O  
сто O  
рублей O  
» O  
. O  
Результат O  
заставляет O  
схватиться O  
за O  
голову O  
. O  

« O  
Переведи O  
» O  
оказалось O  
предлогом O  
, O  
но O  
это O  
вполне O  
логично O  
. O  
Мы O  
определяем O  
грамматику B-Method  
словоформы I-Method  
по O  
последним O  
четырём O  
символам O  
. O  
« O  
Веди O  
» O  
— O  
это O  
что-то O  
типа O  
« O  
посреди O  
» O  
, O  
так O  
что O  
выбор O  
относительно O  
логичен O  
. O  
С O  
« O  
мамой O  
» O  
поинтереснее O  
: O  
« O  
мама O  
» O  
оказалась O  
в O  
предложном O  
падеже O  
и O  
стала O  
вершиной O  
этого O  
предложения O  
. O  

Если O  
пытаться O  
интерпретировать O  
всё O  
, O  
исходя O  
из O  
результатов O  
парсинга B-Method  
, O  
то O  
мы O  
получили O  
бы O  
что-то O  
типа O  
« O  
посреди O  
мамы O  
( O  
мамы O  
кого O  
? O  
чья O  
это O  
мама O  
? O  
) O  
сотни O  
рублей O  
» O  
. O  
Не O  
совсем O  
то O  
, O  
что O  
было O  
в O  
начале O  
. O  
Нужно O  
как-то O  
с O  
этим O  
бороться O  
. O  
И O  
мы O  
придумали O  
, O  
как O  
. O  

В O  
пирамиде O  
анализа O  
синтаксис B-Method  
строится O  
поверх O  
морфологии B-Method  
, O  
на O  
основании O  
морфологических B-Method  
тегов I-Method  
. O  
Вот O  
хрестоматийный O  
пример O  
лингвиста O  
Л.В. B-Person  
Щербы I-Person  
на O  
этот O  
счёт O  
: O  

« O  
Глокая O  
куздра O  
штеко O  
будланула O  
бокра O  
и O  
курдячит O  
бокрёнка O  
» O  
. O  

Анализ O  
этого O  
предложения O  
не O  
вызывает O  
проблем O  
. O  
Почему O  
? O  
Потому O  
что O  
мы O  
, O  
как O  
теггер O  
UDPipe B-Application  
, O  
смотрим O  
на O  
конец O  
слова O  
и O  
понимаем O  
, O  
к O  
какой O  
оно O  
относится O  
части O  
речи O  
и O  
какая O  
это O  
форма O  
. O  
История O  
с O  
« O  
переведи O  
» O  
в O  
качестве O  
предлога O  
совершенно O  
противоречит O  
нашей O  
интуиции O  
, O  
но O  
оказывается O  
логична O  
в O  
тот O  
момент O  
, O  
когда O  
мы O  
пытаемся O  
проделать O  
то O  
же O  
самое O  
с O  
незнакомыми O  
словами O  
. O  
Человек O  
мог O  
бы O  
подумать O  
точно O  
так O  
же O  
. O  

Оценим O  
теггер O  
UDPipe B-Application  
отдельно O  
. O  
Если O  
он O  
нас O  
не O  
устроит O  
, O  
возьмём O  
другой O  
теггер O  
— O  
чтобы O  
потом O  
построить O  
синтаксический B-Method  
парсинг I-Method  
поверх O  
другой O  
морфологической B-Method  
разметки I-Method  
. O  

Tagging B-Method  
from I-Method  
plain I-Method  
text I-Method  
( O  
CoNLL17 B-Activity  
F1 B-Metric  
score I-Metric  
) O  

gold O  
forms O  
: O  
301639 O  
, O  

upostag B-Metric  
: O  
98.15 O  
% O  
, O  

xpostag B-Metric  
: O  
99.89 O  
% O  
, O  

feats O  
: O  
93.97 O  
% O  
, O  

alltags O  
: O  
93.44 O  
% O  
, O  

lemmas O  
: O  
96.68 O  
% O  

Качество O  
морфологии B-Method  
UDPipe B-Application  
2.0 I-Application  
неплохое O  
. O  
Но O  
для O  
русского B-Lang  
языка I-Lang  
достижимо O  
лучше O  
. O  
Анализатор B-Method  
Mystem B-Application  
( O  
разработка O  
яндекса B-Organization  
) O  
в O  
определении O  
частей O  
речи O  
достигает O  
лучших O  
результатов O  
, O  
чем O  
UDPipe B-Application  
. O  
К O  
тому O  
же O  
, O  
остальные O  
анализаторы B-Method  
сложнее O  
имплементировать O  
в O  
python-проект O  
, O  
и O  
они O  
работают O  
медленней O  
при O  
качестве O  
, O  
сопоставимом O  
с O  
Mystem B-Application  
. O  
Кстати O  
, O  
сравнению O  
морфологических B-Method  
анализаторов I-Method  
для O  
русского B-Lang  
языка I-Lang  
посвящена O  
пара O  
интересных O  
статей O  
. O  

Можно O  
попробовать O  
использовать O  
его O  
выходную O  
морфологическую B-Method  
разметку I-Method  
в O  
качестве O  
входа O  
для O  
синтаксического B-Method  
парсера I-Method  
UDPipe B-Application  
. O  
Но O  
есть O  
проблемы O  
. O  
Многие O  
знают O  
, O  
что O  
Mystem B-Application  
не O  
полностью O  
понимает O  
морфологическую B-Method  
омонимию I-Method  
. O  
Он O  
знает O  
, O  
что O  
в O  
предложении O  
« O  
Мама O  
мыла O  
раму O  
» O  
слово O  
« O  
мыла O  
» O  
— O  
от O  
слова O  
« O  
мыть O  
» O  
, O  
а O  
не O  
от O  
« O  
мыло O  
» O  
. O  
Но O  
нам O  
этого O  
мало O  
. O  
Ещё O  
нам O  
нужно O  
, O  
чтобы O  
в O  
словах O  
типа O  
« O  
директора O  
» O  
, O  
где O  
лемма O  
абсолютно O  
очевидна O  
( O  
директор O  
) O  
, O  
мы O  
понимали O  
, O  
какой O  
это O  
конкретно O  
падеж O  
. O  
Это O  
может O  
быть O  
: O  

« O  
нет O  
директора O  
» O  
— O  
родительный O  
падеж O  
единственного O  
числа O  

« O  
я O  
вижу O  
директора O  
» O  
— O  
т.е O  
. O  
винительный O  
падеж O  
единственного O  
числа O  

« O  
это O  
какие-то O  
директора O  
» O  
— O  
именительный O  
падеж O  
множественного O  
числа O  
( O  
ударения-то O  
у O  
нас O  
на O  
письме O  
нет O  
) O  

В O  
таких O  
случаях O  
Mystem B-Application  
честно O  
отдаёт O  
всю O  
цепочку O  
: O  

m.analyze O  
( O  
" O  
нет O  
директора O  
" O  
) O  

[ O  
{ O  
'analysis O  
' O  
: O  
[ O  
{ O  
'lex O  
' O  
: O  
'нет O  
' O  
, O  
'gr O  
' O  
: O  
'PART O  
=' O  
} O  
] O  
, O  
'text O  
' O  
: O  
'нет O  
' O  
} O  
, O  
{ O  
'text O  
' O  
: O  
' O  
} O  
, O  
{ O  
'analysis O  
' O  
: O  
[ O  
{ O  
'lex O  
' O  
: O  
'директор O  
' O  
, O  
'gr O  
' O  
: O  
'S O  
, O  
муж O  
, O  
од O  
= O  
( O  
вин O  
, O  
ед O  
| O  
род O  
, O  
ед O  
| O  
им O  
, O  
мн O  
) O  
' O  
} O  
] O  
, O  
'text O  
' O  
: O  
'директора O  
' O  
} O  
, O  
{ O  
'text O  
' O  
: O  
' O  
\n O  
' O  
} O  
] O  

Но O  
мы O  
не O  
можем O  
подать O  
UDPipe B-Application  
на O  
вход O  
всю O  
цепочку O  
, O  
а O  
должны O  
указать O  
какой-то O  
лучший O  
тег O  
. O  
Как O  
его O  
выбрать O  
? O  
Если O  
ничего O  
не O  
трогать O  
, O  
хочется O  
взять O  
первый O  
, O  
авось O  
сработает O  
. O  
Но O  
теги O  
отсортированы O  
по O  
алфавиту O  
в O  
соответствии O  
с O  
английскими O  
названиями O  
, O  
поэтому O  
наш O  
выбор O  
будет O  
близок O  
к O  
случайному O  
, O  
а O  
некоторые O  
разборы O  
практически O  
лишаются O  
шансов O  
стать O  
первыми O  
. O  

Есть O  
анализатор B-Method  
, O  
который O  
умеет O  
отдавать O  
лучший O  
вариант O  
, O  
— O  
Pymorphy2 B-Application  
. O  
Но O  
с O  
анализом O  
морфологии B-Method  
у O  
него O  
хуже O  
. O  
К O  
тому O  
же O  
, O  
он O  
отдаёт O  
лучшее O  
слово O  
без O  
учёта O  
контекста O  
. O  
Pymorphy2 B-Application  
выдаст O  
только O  
один O  
разбор O  
для O  
« O  
нет O  
директора O  
» O  
, O  
« O  
вижу O  
директора O  
» O  
и O  
« O  
директора O  
» O  
. O  
Он O  
будет O  
не O  
случайным O  
, O  
а O  
действительно O  
лучшим O  
по O  
вероятностям O  
, O  
которые O  
в O  
pymorphy2 B-Application  
считались O  
на O  
отдельном O  
корпусе O  
текстов O  
. O  
Но O  
некоторый O  
процент O  
неверных O  
разборов O  
боевых O  
текстов O  
будет O  
гарантирован O  
, O  
просто O  
потому O  
что O  
в O  
них O  
вполне O  
могут O  
быть O  
фразы O  
с O  
разными O  
реальным O  
формами O  
: O  
как O  
« O  
вижу O  
директора O  
» O  
, O  
так O  
и O  
« O  
директора O  
пришли O  
на O  
встречу O  
» O  
, O  
и O  
« O  
нет O  
директора O  
» O  
. O  
Бесконтекстная O  
вероятность O  
разбора O  
нам O  
не O  
подходит O  
. O  

Как O  
получить O  
контекстно O  
лучший O  
набор O  
тегов O  
? O  
При O  
помощи O  
анализатора B-Method  
RNNMorph B-Application  
. O  
Про O  
него O  
мало O  
кто O  
слышал O  
, O  
но O  
в O  
прошлом O  
году O  
он O  
выиграл O  
соревнование O  
среди O  
морфологических B-Method  
анализаторов I-Method  
, O  
проводившееся O  
в O  
рамках O  
конференции B-Activity  
« O  
Диалог O  
» O  
. O  

У O  
RNNMorph B-Application  
возникает O  
своя O  
проблема O  
: O  
у O  
него O  
нет O  
токенизации B-Method  
. O  
Если O  
Mystem B-Application  
умеет O  
токенизировать B-Method  
сырой O  
текст O  
, O  
то O  
RNNMorph B-Application  
требует O  
на O  
входе O  
список O  
токенов O  
. O  
Чтобы O  
доехать O  
до O  
синтаксиса B-Method  
, O  
придётся O  
сначала O  
применить O  
какой-то O  
внешний O  
токенизатор B-Method  
, O  
потом O  
отдать O  
результат O  
RNNMorph B-Application  
и O  
только O  
потом O  
полученную O  
морфологию B-Method  
скормить O  
синтаксическому B-Method  
парсеру I-Method  
. O  

Вот O  
какие O  
варианты O  
у O  
нас O  
есть O  
. O  
Не O  
будем O  
пока O  
отказываться O  
от O  
бесконтекстного O  
разбора O  
в O  
pymorphy2 B-Application  
поверх O  
спорных O  
случаев O  
в O  
Mystem B-Application  
— O  
вдруг O  
он O  
от O  
RNNMorph B-Application  
отстанет O  
не O  
сильно O  
. O  
Хотя O  
если O  
сравнивать O  
их O  
чисто O  
на O  
уровне O  
качества O  
морфологической B-Method  
разметки I-Method  
( O  
данные O  
с O  
MorphoRuEval-2017 B-Activity  
) O  
, O  
то O  
проигрыш O  
получается O  
значительный O  
— O  
порядка O  
15 O  
% O  
, O  
если O  
считать O  
accuracy B-Metric  
по O  
словам O  
. O  

Дальше O  
нам O  
нужно O  
конвертировать O  
выдачу O  
Mystem B-Application  
в O  
тот O  
формат O  
, O  
который O  
понимает O  
UDPipe B-Application  
, O  
— O  
conllu O  
. O  
И O  
это O  
опять O  
проблема O  
, O  
даже O  
целых O  
две O  
. O  
Чисто O  
техническая O  
— O  
строки O  
не O  
совпадают O  
. O  
И O  
концептуальная O  
— O  
не O  
всегда O  
до O  
конца O  
понятно O  
, O  
как O  
их O  
сопоставить O  
. O  
Сталкиваясь O  
с O  
двумя O  
разными O  
разметками O  
языковых O  
данных O  
, O  
вы O  
почти O  
наверняка O  
упрётесь O  
в O  
проблему O  
соответствия O  
тегов O  
, O  
см O  
. O  
примеры O  
ниже O  
. O  
Ответы O  
на O  
вопрос O  
« O  
какой O  
тег O  
здесь O  
правильный O  
» O  
могут O  
быть O  
разные O  
, O  
и O  
, O  
вероятно O  
, O  
правильный O  
ответ O  
зависит O  
от O  
задачи O  
. O  
Из-за O  
такой O  
непоследовательности O  
сопоставление O  
систем O  
разметок O  
— O  
само O  
по O  
себе O  
непростая O  
задача O  
. O  

Как O  
конвертировать O  
? O  
Есть O  
russian_tagsets_package B-Application  
— O  
пакет O  
для O  
Python O  
, O  
который O  
умеет O  
конвертировать O  
разные O  
форматы O  
. O  
Там O  
нет O  
перевода O  
из O  
формата O  
выдачи O  
Mystem B-Application  
в O  
Conllu B-InfoResource  
, O  
который O  
принят O  
в O  
Universal B-InfoResource  
Dependencies I-InfoResource  
, O  
но O  
зато O  
есть O  
перевод O  
в O  
conllu O  
, O  
например O  
, O  
из O  
формата O  
разметки O  
национального B-InfoResource  
корпуса I-InfoResource  
русского I-InfoResource  
языка I-InfoResource  
( O  
и O  
обратно O  
) O  
. O  
Автор O  
пакета O  
( O  
кстати O  
, O  
он O  
же O  
автор O  
pymorphy2 B-Application  
) O  
прямо O  
в O  
документации O  
написал O  
замечательную O  
вещь O  
: O  
« O  
Если O  
вы O  
можете O  
не O  
пользоваться O  
этим O  
пакетом O  
, O  
не O  
пользуйтесь O  
им O  
» O  
. O  
Он O  
сделал O  
это O  
не O  
потому O  
, O  
что O  
криворукий O  
программист O  
( O  
он O  
превосходный O  
программист O  
! O  
) O  
, O  
а O  
потому O  
что O  
если O  
вам O  
надо O  
конвертировать O  
одно O  
в O  
другое O  
, O  
то O  
вы O  
рискуете O  
получить O  
проблемы O  
из-за O  
лингвистического O  
несоответствия O  
конвенций O  
разметок O  
. O  

Вот O  
пример O  
. O  
В O  
школе O  
учили O  
« O  
категории O  
состояния O  
» O  
( O  
холодно O  
, O  
нужно O  
) O  
. O  
Одни O  
говорят O  
— O  
это O  
наречие O  
, O  
другие O  
— O  
прилагательное O  
. O  
Вам O  
нужно O  
это O  
конвертировать O  
, O  
и O  
вы O  
дописываете O  
какие-то O  
правила O  
, O  
но O  
всё равно O  
не O  
добиваетесь O  
однозначного O  
соответствия O  
между O  
одним O  
форматом O  
и O  
другим O  
. O  

Другой O  
пример O  
: O  
залог O  
( O  
либо O  
кто-то O  
что-то O  
делал O  
, O  
либо O  
с O  
кем-то O  
что-то O  
сделали O  
) O  
. O  
« O  
Петя O  
кого-то O  
убил O  
» O  
или O  
« O  
Петя O  
был O  
убит O  
» O  
. O  
« O  
Вася O  
фотографирует O  
» O  
— O  
« O  
Вася O  
фотографируется O  
» O  
( O  
т.е O  
. O  
на O  
самом O  
деле O  
« O  
Васю O  
фотографируют O  
» O  
) O  
. O  
В O  
SynTagRus B-Dataset  
есть O  
ещё O  
медиальный O  
залог O  
— O  
не O  
будем O  
даже O  
углубляться O  
в O  
то O  
, O  
что O  
это O  
и O  
почему O  
. O  
А O  
в O  
Mystem B-Application  
его O  
нет O  
. O  
Если O  
нужно O  
как-то O  
один O  
формат O  
привести O  
к O  
другому O  
, O  
это O  
тупик O  
. O  

Мы O  
более-менее O  
честно O  
воспользовались O  
советом O  
автора O  
пакета O  
russian_tagsets B-Application  
— O  
не O  
использовали O  
его O  
разработку O  
, O  
потому O  
что O  
не O  
нашли O  
нужной O  
пары O  
в O  
списке O  
соответствий O  
форматов O  
. O  
В O  
итоге O  
мы O  
написали O  
свой O  
кастомный O  
конвертер O  
из O  
Mystem B-Application  
в O  
Conllu B-InfoResource  
и O  
поехали O  
дальше O  
. O  

Соединяем O  
сторонний O  
теггер O  
и O  
парсер B-Method  
UDPipe B-Application  

После O  
всех O  
приключений O  
мы O  
взяли O  
три O  
алгоритма O  
, O  
про O  
которые O  
рассказывали O  
выше O  
: O  

baseline O  
UDPipe B-Application  

Mystem B-Application  
с O  
дизамбигуацией O  
тегов O  
от O  
pymorphy2 B-Application  

RNNMorph B-Application  

Мы O  
потеряли O  
в O  
качестве O  
по O  
довольно O  
понятной O  
причине O  
. O  
Мы O  
брали O  
модель B-Model  
UDPipe B-Application  
, O  
обученную O  
на O  
одной O  
морфологии B-Method  
, O  
но O  
подсовывали O  
на O  
вход O  
другую O  
морфологию B-Method  
. O  
Классическая O  
проблема O  
несоответствия O  
данных O  
трейна O  
и O  
теста O  
— O  
отсюда O  
и O  
падение O  
качества O  
. O  

Мы O  
пытались O  
наши O  
автоматические O  
инструменты O  
морфологической B-Method  
разметки I-Method  
привести O  
в O  
соответствие O  
с O  
разметкой O  
SynTagRus B-Dataset  
, O  
который O  
размечен O  
вручную O  
. O  
У O  
нас O  
не O  
получилось O  
, O  
поэтому O  
в O  
обучающем O  
корпусе O  
SynTagRus B-Dataset  
мы O  
заменим O  
всю O  
ручную O  
морфологическую B-Method  
разметку I-Method  
на O  
полученную O  
из O  
Mystem B-Application  
и O  
pymorphy2 B-Application  
в O  
одном O  
случае O  
и O  
из O  
RNNMorph B-Application  
в O  
другом O  
. O  
В O  
размеченном O  
руками O  
валидированном O  
корпусе O  
мы O  
вынуждены O  
менять O  
ручную O  
разметку O  
на O  
автоматическую O  
, O  
потому O  
что O  
« O  
в O  
бою O  
» O  
мы O  
никогда O  
не O  
получим O  
ручную O  
разметку O  
. O  

В O  
итоге O  
мы O  
обучили O  
парсер B-Method  
UDPipe B-Application  
( O  
только O  
парсер B-Method  
) O  
с O  
такими O  
же O  
гиперпараметрами O  
, O  
как O  
у O  
baseline O  
. O  
То O  
, O  
что O  
отвечало O  
за O  
синтаксис B-Method  
, O  
— O  
ID O  
вершины O  
, O  
от O  
кого O  
зависит O  
и O  
тип O  
связи O  
— O  
мы O  
оставили O  
, O  
всё O  
остальное O  
поменяли O  
. O  

Результаты O  

Дальше O  
буду O  
сравнивать O  
нас O  
с O  
Syntaxnet B-Application  
и O  
остальными O  
алгоритмами O  
. O  
Организаторы O  
CoNLL B-Activity  
Shared I-Activity  
Task I-Activity  
зарелизили O  
разбиение O  
SynTagRus B-Dataset  
( O  
train B-Object  
/ O  
dev B-Object  
/ O  
test B-Object  
80 O  
/ O  
10 O  
/ O  
10 O  
) O  
. O  
Мы O  
изначально O  
взяли O  
другое O  
( O  
train B-Object  
/ O  
test B-Object  
70 O  
/ O  
30 O  
) O  
, O  
поэтому O  
у O  
нас O  
не O  
всегда O  
совпадают O  
данные O  
, O  
хотя O  
они O  
и O  
получены O  
на O  
том O  
же O  
корпусе O  
. O  
Кроме O  
того O  
, O  
мы O  
взяли O  
последний O  
( O  
по O  
состоянию O  
на O  
февраль-март O  
) O  
релиз O  
из O  
репозитория O  
SynTagRus B-Dataset  
— O  
эта O  
версия O  
немного O  
отличается O  
от O  
той O  
, O  
что O  
была O  
на O  
соревновании O  
. O  
Данные O  
для O  
того O  
, O  
что O  
у O  
нас O  
не O  
взлетело O  
, O  
приводятся O  
по O  
статьям O  
, O  
где O  
сплит O  
был O  
такой O  
же O  
, O  
как O  
на O  
соревновании O  
— O  
такие O  
алгоритмы O  
помечены O  
в O  
таблице O  
звёздочкой O  
. O  

Вот O  
итоговые O  
результаты O  
: O  

RNNMorph B-Application  
действительно O  
оказался O  
лучше O  
— O  
не O  
в O  
абсолютном O  
смысле O  
, O  
а O  
в O  
роли O  
вспомогательного O  
инструмента O  
для O  
получения O  
общей O  
метрики B-Metric  
по O  
итогам O  
синтаксического B-Method  
анализа I-Method  
( O  
по O  
сравнению O  
с O  
Mystem B-Application  
+ O  
pymorphy2 B-Application  
) O  
. O  
То O  
есть O  
чем O  
лучше O  
морфология B-Method  
, O  
тем O  
лучше O  
синтаксис B-Method  
, O  
но O  
при O  
этом O  
« O  
синтаксический O  
» O  
отрыв O  
значительно O  
меньше O  
морфологического B-Method  
. O  
Заметим O  
также O  
, O  
что O  
мы O  
не O  
очень O  
далеко O  
уехали O  
от O  
baseline-модели O  
, O  
а O  
значит O  
, O  
в O  
морфологии B-Method  
на O  
самом O  
деле O  
лежало O  
не O  
так O  
много O  
, O  
как O  
мы O  
предполагали O  
. O  

Интересно O  
, O  
много O  
ли O  
вообще O  
лежит O  
на O  
морфологии B-Method  
? O  
Можно O  
ли O  
добиться O  
принципиального O  
улучшения O  
синтаксического B-Method  
парсера I-Method  
за O  
счёт O  
идеальной O  
морфологии B-Method  
? O  
Чтобы O  
ответить O  
на O  
этот O  
вопрос O  
, O  
мы O  
прогнали O  
UDPipe B-Application  
2.0 I-Application  
на O  
идеально O  
выверенной O  
( O  
на O  
стандарте O  
ручной O  
разметки O  
) O  
токенизации B-Method  
и O  
морфологии B-Method  
. O  
Получился O  
некоторый O  
отрыв O  
( O  
см O  
. O  
в O  
таблице O  
строчку O  
про O  
Gold B-Model  
Morph I-Model  
; O  
получается O  
+1.54 O  
% O  
от O  
RNNMorph_reannotated_syntax O  
) O  
от O  
того O  
, O  
что O  
было O  
у O  
нас O  
, O  
в O  
том O  
числе O  
, O  
с O  
точки O  
зрения O  
верного O  
определения O  
типа O  
связи O  
. O  
Если O  
кто-то O  
когда-то O  
напишет O  
абсолютно O  
идеальный O  
морфологический B-Method  
анализатор I-Method  
русского B-Lang  
языка I-Lang  
, O  
вероятно O  
, O  
результаты O  
, O  
которые O  
мы O  
получим O  
, O  
используя O  
абстрактный O  
синтаксический B-Method  
парсер I-Method  
, O  
тоже O  
вырастут O  
. O  
И O  
мы O  
примерно O  
понимаем O  
потолок O  
( O  
по O  
крайней O  
мере O  
, O  
потолок O  
по O  
той O  
архитектуре O  
и O  
по O  
тому O  
сочетанию O  
параметров O  
, O  
которое O  
мы O  
использовали O  
для O  
UDPipe B-Application  
, O  
— O  
он O  
приведен O  
в O  
третьей O  
строчке O  
таблицы O  
выше O  
) O  
. O  

Интересно O  
, O  
что O  
мы O  
почти O  
дотянулись O  
по O  
метрике B-Metric  
LAS I-Metric  
до O  
версии O  
Syntaxnet B-Application  
. O  
Понятно O  
, O  
что O  
у O  
нас O  
немного O  
разные O  
данные O  
, O  
но O  
в O  
принципе O  
всё O  
равно O  
сопоставимо O  
. O  
У O  
Syntaxnet B-Application  
токенизация B-Method  
« O  
золотая O  
» O  
, O  
а O  
у O  
нас O  
— O  
от O  
Mystem B-Application  
. O  
Мы O  
написали O  
вышеупомянутую O  
обёртку O  
к O  
Mystem B-Application  
, O  
но O  
разбор O  
всё O  
равно O  
проходит O  
автоматически O  
; O  
вероятно O  
, O  
Mystem B-Application  
тоже O  
где-то O  
ошибается O  
. O  
Из O  
строчки O  
таблицы O  
« O  
UDPipe B-Application  
2.0 I-Application  
gold B-Model  
tok I-Model  
» O  
видно O  
, O  
что O  
если O  
взять O  
дефолтный O  
UDPipe B-Application  
и O  
золотую O  
токенизацию B-Method  
, O  
то O  
он O  
всё же O  
немного O  
проигрывает O  
Syntaxnet B-Application  
-2017 I-Application  
. O  
Но O  
зато O  
работает O  
намного O  
быстрее O  
. O  

До O  
чего O  
не O  
дотянулся O  
никто O  
, O  
так O  
это O  
до O  
стенфордского B-Application  
парсера I-Application  
. O  
Он O  
устроен O  
так O  
же O  
, O  
как O  
Syntaxnet B-Application  
, O  
поэтому O  
работает O  
долго O  
. O  
В O  
UDPipe B-Application  
мы O  
идём O  
просто O  
по O  
стеку O  
. O  
В O  
архитектуре O  
стенфордского B-Application  
парсера I-Application  
и O  
Syntaxnet B-Application  
заложена O  
другая O  
концепция O  
: O  
сначала O  
они O  
генерируют O  
полный O  
ориентированный O  
граф O  
, O  
и O  
дальше O  
работа O  
алгоритма O  
состоит O  
в O  
том O  
, O  
чтобы O  
оставить O  
тот O  
скелет O  
( O  
минимальное O  
остовное O  
дерево O  
) O  
, O  
который O  
будет O  
наиболее O  
вероятным O  
. O  
Для O  
этого O  
он O  
перебирает O  
комбинации O  
, O  
а O  
этот O  
перебор O  
уже O  
не O  
линеен O  
, O  
потому O  
что O  
к O  
одному O  
слову O  
вы O  
будете O  
обращаться O  
не O  
единожды O  
. O  
Несмотря O  
на O  
то O  
, O  
что O  
это O  
долго O  
, O  
с O  
точки O  
зрения O  
чистой O  
науки B-Science  
, O  
по O  
крайней O  
мере O  
для O  
русского B-Lang  
языка I-Lang  
, O  
— O  
это O  
более O  
эффективная O  
архитектура O  
. O  
Мы O  
пытались O  
поднять O  
эту O  
академическую O  
разработку O  
два O  
дня O  
— O  
увы O  
, O  
не O  
получилось O  
. O  
Но O  
исходя O  
из O  
его O  
архитектуры O  
понятно O  
, O  
что O  
работает O  
он O  
не O  
быстро O  
. O  

Что O  
касается O  
нашего O  
подхода O  
— O  
хотя O  
мы O  
формально O  
по O  
метрикам B-Metric  
почти O  
не O  
поднялись O  
, O  
зато O  
у O  
нас O  
теперь O  
с O  
« O  
мамой O  
» O  
всё O  
в порядке O  
. O  

Во O  
фразе O  
« O  
переведи O  
маме O  
сто O  
рублей O  
» O  
у O  
нас O  
« O  
переведи O  
» O  
— O  
действительно O  
глагол O  
в O  
повелительном O  
наклонении O  
. O  
« O  
мама O  
» O  
получила O  
свой O  
дательный O  
падеж O  
. O  
И O  
самое O  
главное O  
для O  
нас O  
— O  
наша O  
метка O  
( O  
iobj O  
) O  
косвенный O  
объект O  
( O  
адресат O  
) O  
. O  
Хотя O  
прирост O  
по O  
цифрам O  
незначительный O  
, O  
мы O  
хорошо O  
справились O  
с O  
той O  
проблемой O  
, O  
с O  
которой O  
задача O  
начиналась O  
. O  

Bonus O  
track O  
: O  
пунктуация O  

Если O  
вернуться O  
к O  
реальным O  
данным O  
, O  
то O  
выясняется O  
, O  
что O  
синтаксис B-Method  
зависит O  
от O  
пунктуации O  
. O  
Возьмём O  
фразу O  
« O  
казнить O  
нельзя O  
помиловать O  
» O  
. O  
Что O  
именно O  
нельзя O  
— O  
« O  
казнить O  
» O  
или O  
« O  
помиловать O  
» O  
— O  
зависит O  
от O  
того O  
, O  
где O  
стоит O  
запятая O  
. O  
Даже O  
если O  
мы O  
посадим O  
лингвиста O  
размечать O  
данные O  
, O  
ему O  
нужна O  
будет O  
пунктуация O  
как O  
некоторый O  
вспомогательный O  
инструмент O  
. O  
Без O  
неё O  
он O  
не O  
справится O  
. O  

Возьмём O  
фразы O  
« O  
Петя O  
привет O  
» O  
и O  
« O  
Петя O  
, O  
привет O  
» O  
и O  
посмотрим O  
на O  
их O  
разбор O  
baseline-UDPipe B-Model  
моделью O  
. O  
Оставим O  
за O  
скобками O  
проблемы O  
того O  
, O  
что O  
, O  
если O  
верить O  
этой O  
модели B-Model  
, O  
то O  
: O  

1 O  
) O  
« O  
Петя O  
» O  
— O  
это O  
существительное O  
женского O  
рода O  
; O  

2 O  
) O  
« O  
Петя O  
» O  
— O  
это O  
( O  
судя O  
по O  
набору O  
тегов O  
) O  
начальная O  
форма O  
, O  
но O  
при O  
этом O  
лемма O  
у O  
него O  
якобы O  
не O  
« O  
Петя O  
» O  
. O  

Вот O  
как O  
меняется O  
результат O  
из-за O  
запятой O  
, O  
с O  
её O  
помощью O  
мы O  
получаем O  
нечто O  
похожее O  
на O  
правду O  
. O  

Во O  
втором O  
случае O  
« O  
Петя O  
» O  
— O  
это O  
субъект O  
, O  
а O  
« O  
привет O  
» O  
— O  
это O  
глагол O  
. O  
Вернёмся O  
к O  
предсказанию O  
формы O  
слова O  
на O  
основании O  
последних O  
четырёх O  
символов O  
. O  
В O  
трактовке O  
алгоритма O  
это O  
не O  
« O  
Петя O  
привет O  
» O  
, O  
а O  
« O  
Петя O  
привёт O  
» O  
. O  
Типа O  
« O  
Петя O  
поёт O  
» O  
или O  
« O  
Петя O  
придёт O  
» O  
. O  
Разбор O  
довольно O  
понятный O  
: O  
в O  
русском B-Lang  
языке I-Lang  
запятой O  
между O  
подлежащим O  
и O  
сказуемым O  
быть O  
не O  
может O  
. O  
Поэтому O  
если O  
запятая O  
стоит O  
, O  
это O  
слово O  
« O  
привет O  
» O  
, O  
а O  
если O  
запятой O  
нет O  
, O  
это O  
вполне O  
может O  
быть O  
что-то O  
вроде O  
« O  
Петя O  
привёт O  
» O  
. O  

Сталкиваться O  
с O  
этим O  
на O  
продакшене O  
мы O  
будем O  
достаточно O  
часто O  
, O  
потому O  
что O  
орфографию O  
спеллчекеры O  
исправят O  
, O  
а O  
пунктуацию O  
— O  
нет O  
. O  
Что O  
ещё O  
хуже O  
, O  
пользователь O  
может O  
неправильно O  
ставить O  
запятые O  
, O  
и O  
наш O  
алгоритм O  
будет O  
учитывать O  
их O  
в O  
понимании O  
естественного B-Task  
языка I-Task  
. O  
Какие O  
здесь O  
есть O  
возможные O  
решения O  
? O  
Мы O  
видим O  
два O  
варианта O  
. O  

Первый O  
вариант O  
— O  
сделать O  
так O  
, O  
как O  
иногда O  
делают O  
при O  
переводе O  
речи O  
в O  
текст O  
. O  
Изначально O  
в O  
таком O  
тексте O  
нет O  
никакой O  
пунктуации O  
, O  
поэтому O  
она O  
восстанавливается O  
через O  
модель B-Model  
. O  
На O  
выходе O  
получается O  
относительно O  
грамотный O  
с O  
точки O  
зрения O  
правил O  
русского B-Lang  
языка I-Lang  
материал O  
, O  
который O  
помогает O  
корректно O  
работать O  
синтаксическому B-Method  
парсеру I-Method  
. O  

Вторая O  
идея O  
несколько O  
более O  
смелая O  
и O  
противоречащая O  
школьным O  
урокам O  
русского B-Lang  
языка I-Lang  
. O  
Она O  
предполагает O  
работу O  
без O  
пунктуации O  
: O  
если O  
вдруг O  
входные O  
данные O  
будут O  
с O  
пунктуацией O  
, O  
мы O  
её O  
оттуда O  
уберём O  
. O  
Из O  
обучающего O  
корпуса O  
тоже O  
удалим O  
абсолютно O  
всю O  
пунктуацию O  
. O  
Будем O  
считать O  
, O  
что O  
русский B-Lang  
язык I-Lang  
существует O  
без O  
пунктуации O  
. O  
Только O  
точки O  
для O  
разделения O  
на O  
предложения O  
. O  

Технически O  
это O  
довольно O  
просто O  
, O  
потому O  
что O  
мы O  
никак O  
не O  
меняем O  
в O  
синтаксическом B-Method  
дереве O  
неконечные O  
узлы O  
. O  
У O  
нас O  
не O  
может O  
быть O  
такого O  
, O  
что O  
знак O  
пунктуации O  
— O  
это O  
вершина O  
. O  
Это O  
всегда O  
некоторый O  
конечный O  
узел O  
, O  
кроме O  
знака O  
% O  
, O  
который O  
почему-то O  
в O  
SynTagRus B-Dataset  
является O  
вершиной O  
для O  
предшествующего O  
числительного O  
( O  
50 O  
% O  
в O  
SynTagRus B-Dataset  
размечено O  
как O  
% O  
— O  
вершина O  
, O  
а O  
50 O  
— O  
зависимое O  
) O  
. O  

Проведём O  
тесты O  
с O  
использованием O  
Mystem B-Application  
( O  
+pymorphy 2 B-Application  
) O  
модели B-Model  
. O  

Нам O  
критически O  
важно O  
не O  
дать O  
модели B-Model  
без O  
пунктуации O  
текст O  
с O  
пунктуацией O  
. O  
Но O  
зато O  
если O  
мы O  
всегда O  
будем O  
давать O  
текст O  
без O  
пунктуации O  
, O  
то O  
мы O  
будем O  
оказываться O  
в O  
рамках O  
верхней O  
строчки O  
и O  
получать O  
как O  
минимум O  
приемлемые O  
результаты O  
. O  
Если O  
текст O  
без O  
пунктуации O  
и O  
модель B-Model  
будет O  
работать O  
непунктуационная O  
, O  
то O  
относительно O  
идеальной O  
пунктуации O  
и O  
пунктуационной O  
модели B-Model  
получится O  
падение O  
всего O  
примерно O  
в O  
3 O  
% O  
. O  

Что O  
с O  
этим O  
делать O  
? O  
Мы O  
можем O  
остановиться O  
на O  
этих O  
цифрах O  
— O  
полученных O  
с O  
помощью O  
беспунктуационной O  
модели B-Model  
и O  
чистки O  
пунктуации O  
. O  
Или O  
придумать O  
какой-то O  
классификатор O  
, O  
чтобы O  
восстанавливать O  
пунктуацию O  
. O  
Идеальных O  
цифр O  
( O  
тех O  
, O  
что O  
с O  
пунктуацией O  
на O  
пунктуационной O  
модели B-Model  
) O  
мы O  
уже O  
не O  
добьёмся O  
, O  
потому O  
что O  
алгоритм O  
восстановления O  
пунктуации O  
работает O  
с O  
некоторой O  
погрешностью O  
, O  
а O  
« O  
идеальные O  
» O  
цифры O  
были O  
рассчитаны O  
на O  
абсолютно O  
чистом O  
SynTagRus B-Dataset  
. O  
Но O  
если O  
мы O  
будем O  
писать O  
модель B-Model  
, O  
восстанавливающую O  
пунктуацию O  
, O  
окупит O  
ли O  
прогресс O  
наши O  
затраты O  
? O  
Ответ O  
пока O  
неочевиден O  
. O  

Мы O  
можем O  
долго O  
размышлять O  
про O  
архитектуру O  
парсера B-Method  
, O  
но O  
должны O  
помнить O  
, O  
что O  
на O  
самом O  
деле O  
пока O  
нет O  
большого O  
синтаксически O  
размеченного O  
корпуса O  
веб-текстов O  
. O  
Его O  
существование O  
помогло O  
бы O  
лучше O  
решать O  
реальные O  
задачи O  
. O  
Пока O  
что O  
мы O  
учимся O  
на O  
корпусах O  
абсолютно O  
грамотных O  
, O  
отредактированных O  
текстов O  
— O  
и O  
теряем O  
в O  
качестве O  
, O  
получая O  
на O  
бою O  
пользовательские O  
тексты O  
, O  
которые O  
зачастую O  
написаны O  
неграмотно O  
. O  

Заключение O  

Мы O  
рассмотрели O  
использование O  
различных O  
алгоритмов O  
синтаксического B-Method  
парсинга I-Method  
, O  
основанного O  
на O  
грамматике B-Method  
зависимостей I-Method  
, O  
применительно O  
к O  
русскому B-Lang  
языку I-Lang  
. O  
Оказалось O  
, O  
что O  
с O  
точки O  
зрения O  
скорости O  
, O  
удобства O  
и O  
качества O  
работы O  
наилучшим O  
инструментом O  
оказался O  
UDPipe B-Application  
. O  
Его O  
baseline-модель B-Model  
можно O  
улучшить O  
, O  
если O  
отдать O  
этапы O  
токенизации B-Method  
и O  
морфологического B-Method  
анализа I-Method  
на O  
откуп O  
другим O  
, O  
сторонним O  
, O  
анализаторам O  
: O  
такой O  
трюк O  
даёт O  
возможность O  
исправлять O  
некорректное O  
поведение O  
теггера O  
и O  
, O  
как O  
следствие O  
, O  
парсера B-Method  
в O  
важных O  
для O  
анализа O  
случаях O  
. O  

Также O  
мы O  
проанализировали O  
проблему O  
взаимосвязи O  
пунктуации O  
и O  
парсинга B-Method  
и O  
пришли O  
к O  
выводу O  
, O  
что O  
в O  
нашем O  
случае O  
пунктуацию O  
перед O  
синтаксическим B-Method  
парсингом I-Method  
лучше O  
удалять O  
. O  

Надеемся O  
, O  
что O  
прикладные O  
моменты O  
, O  
разобранные O  
в O  
нашей O  
статье O  
, O  
помогут O  
использовать O  
синтаксический B-Method  
парсинг I-Method  
для O  
решения O  
ваших O  
задач O  
максимально O  
эффективно O  
. O  

Автор O  
благодарит O  
за O  
помощь O  
в O  
подготовке O  
статьи O  
Никиту B-Person  
Кузнецова I-Person  
и O  
Наталью B-Person  
Филиппову I-Person  
; O  
за O  
помощь O  
в O  
исследовании O  
— O  
Антона B-Person  
Алексеева I-Person  
, O  
Никиту B-Person  
Кузнецова I-Person  
, O  
Андрея B-Person  
Кутузова I-Person  
, O  
Бориса B-Person  
Орехова I-Person  
и O  
Михаила B-Person  
Попова I-Person  
. O  

Tags O  
: O  
парсерыкомпьютерная O  
лингвистикасинтаксисUDPipedependency O  
parsingnlp O  
Hubs O  
: O  
Сбер B-Organization  
corporate I-Organization  
blog I-Organization  
Programming B-Subject  
Machine B-Method_ML  
learning I-Method_ML  
Artificial B-Method_ML  
Intelligence I-Method_ML